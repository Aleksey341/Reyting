# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Amvera

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞

Production –ë–î –Ω–∞ Amvera –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–ª–æ–Ω–∫–∏ `leader_name` –≤ —Ç–∞–±–ª–∏—Ü–µ `dim_mo`.

**–û—à–∏–±–∫–∞:**
```
psycopg2.errors.UndefinedColumn: column dim_mo.leader_name does not exist
```

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

API —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–∞ —Å–ª—É—á–∞—è:
- **–° –∫–æ–ª–æ–Ω–∫–æ–π `leader_name`** (–ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏)
- **–ë–µ–∑ –∫–æ–ª–æ–Ω–∫–∏** (—Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç NULL)

–ù–æ –¥–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é.

## üöÄ –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ Amvera

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä Amvera

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
amvera ssh

# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î
psql -U reyting_user -d reytingdb -h amvera-alex1976-cnpq-reyting-mo-rw

# –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –∫–æ–º–∞–Ω–¥—É
ALTER TABLE dim_mo ADD COLUMN leader_name VARCHAR(255);
CREATE INDEX idx_dim_mo_leader_name ON dim_mo(leader_name);
```

### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ pgAdmin (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)

1. –û—Ç–∫—Ä–æ–π—Ç–µ pgAdmin
2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ production –ë–î
3. –û—Ç–∫—Ä–æ–π—Ç–µ SQL Query tool
4. –í—ã–ø–æ–ª–Ω–∏—Ç–µ:
```sql
ALTER TABLE dim_mo ADD COLUMN leader_name VARCHAR(255);
CREATE INDEX idx_dim_mo_leader_name ON dim_mo(leader_name);
```

### –°–ø–æ—Å–æ–± 3: –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ Amvera

–î–æ–±–∞–≤—å—Ç–µ –≤ `amvera.yml` (–µ—Å–ª–∏ –µ—Å—Ç—å —Å–µ–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏):

```yaml
init:
  - name: Apply migrations
    run: |
      psql $DATABASE_URL -f backend/migrations/add_leader_name_to_mo.sql
```

## üìã SQL –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏

```sql
-- –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É
ALTER TABLE dim_mo ADD COLUMN IF NOT EXISTS leader_name VARCHAR(255);

-- –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å
CREATE INDEX IF NOT EXISTS idx_dim_mo_leader_name ON dim_mo(leader_name);
```

## ‚úîÔ∏è –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
# API –¥–æ–ª–∂–µ–Ω —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å leader_name
curl "https://reyting-alex1976.amvera.io/api/rating?period=2024-01&page=1"

# –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∫–ª—é—á–∏—Ç –ø–æ–ª–µ leader_name (–¥–∞–∂–µ –µ—Å–ª–∏ NULL):
{
  "data": [{
    "mo_id": 1,
    "mo_name": "–õ–∏–ø–µ—Ü–∫",
    "leader_name": null,  # –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –ø–æ—Å–ª–µ UPDATE
    "score_total": 61,
    ...
  }]
}
```

## üìù –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏)

```bash
# –ó–∞–ø–æ–ª–Ω–∏—Ç—å –§–ò–û –≥–ª–∞–≤ –ú–û
psql $DATABASE_URL -f backend/migrations/sample_leader_data.sql

# –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
psql $DATABASE_URL -f etl/fill_rating_data.sql
```

## üîÑ –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏)

API –≤—Å–µ –µ—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç! –û–Ω –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `leader_name: null` –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π, –ø–æ–∫–∞ –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞.

```json
{
  "mo_id": 1,
  "mo_name": "–õ–∏–ø–µ—Ü–∫",
  "leader_name": "–ù–µ —É–∫–∞–∑–∞–Ω–æ",  // –ë—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–æ –¥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏
  "score_total": 61,
  "zone": "green"
}
```

## üéØ –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

1. ‚úÖ **API –æ–±–Ω–æ–≤–ª–µ–Ω** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å/–±–µ–∑ –∫–æ–ª–æ–Ω–∫–∏
2. ‚è≥ **–ù—É–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ Amvera** - –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É
3. ‚è≥ **–ó–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ** - –æ–±–Ω–æ–≤–∏—Ç—å –§–ò–û –∏ —Ä–µ–π—Ç–∏–Ω–≥–∏

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ï—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—Ç–µ –∫–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Amvera –ë–î:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ `backend/config.py`
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Amvera dashboard –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ë–î
3. –ò–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ SQL –∫–æ–º–∞–Ω–¥—É –≤ Amvera support

---

**–î–∞—Ç–∞:** 16 –Ω–æ—è–±—Ä—è 2024
**–°—Ç–∞—Ç—É—Å:** API –≤—Ä–µ–º–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ leader_name
