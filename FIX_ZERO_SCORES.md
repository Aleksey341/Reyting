# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –Ω—É–ª–µ–≤—ã—Ö –æ—Ü–µ–Ω–æ–∫

## üîç –ù–∞–π–¥–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

API —á–∏—Ç–∞–µ—Ç –æ—Ü–µ–Ω–∫–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `fact_summary` (–∏—Ç–æ–≥–∏), –Ω–æ —ç—Ç–∞ —Ç–∞–±–ª–∏—Ü–∞ –±—ã–ª–∞ –ø—É—Å—Ç–æ–π.
–î–∞–Ω–Ω—ã–µ –µ—Å—Ç—å –≤ `fact_indicator` (–∏—Å—Ö–æ–¥–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏), –Ω–æ –æ–Ω–∏ –Ω–µ —Å—É–º–º–∏—Ä–æ–≤–∞–ª–∏—Å—å –≤ –∏—Ç–æ–≥–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è `calculate_fact_summary_from_indicators()` –∫–æ—Ç–æ—Ä–∞—è:
1. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—É–º–º—É –æ—Ü–µ–Ω–æ–∫ –ø–æ –ü–£–ë–õ–ò–ß–ù–û–ú–£ —Ä–µ–π—Ç–∏–Ω–≥—É
2. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—É–º–º—É –æ—Ü–µ–Ω–æ–∫ –ø–æ –ó–ê–ö–†–´–¢–û–ú–£ —Ä–µ–π—Ç–∏–Ω–≥—É
3. –î–æ–±–∞–≤–ª—è–µ—Ç —à—Ç—Ä–∞—Ñ—ã (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –±–∞–ª–ª—ã)
4. –í—ã—á–∏—Å–ª—è–µ—Ç –∏—Ç–æ–≥–æ–≤—ã–π –±–∞–ª–ª
5. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∑–æ–Ω—É —Ä–∏—Å–∫–∞ (–ó–µ–ª—ë–Ω–∞—è/–ñ—ë–ª—Ç–∞—è/–ö—Ä–∞—Å–Ω–∞—è)
6. –ó–∞–ø–æ–ª–Ω—è–µ—Ç —Ç–∞–±–ª–∏—Ü—É `fact_summary`

## üìã –ü–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π

### 1. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ –Ω–∞ Amvera
```bash
git pull origin main
# –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑—å–º—ë—Ç –Ω–æ–≤—ã–π –∫–æ–¥)
```

### 2. –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL —Å–∫—Ä–∏–ø—Ç –Ω–∞ –ë–î Amvera
```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ DBeaver/pgAdmin –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ load_official_data.sql
# –≠—Ç–æ –∑–∞–ø–æ–ª–Ω–∏—Ç —Ç–∞–±–ª–∏—Ü—É fact_indicator –¥–∞–Ω–Ω—ã–º–∏
```

### 3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ Amvera
–ö–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è:
- –í—ã–ø–æ–ª–Ω–∏—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è `implement_official_methodology()` (—Å–æ–∑–¥–∞—Å—Ç 16 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤)
- –í—ã–ø–æ–ª–Ω–∏—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è `calculate_fact_summary_from_indicators()` (—Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç —Å—É–º–º—ã)
- –¢–∞–±–ª–∏—Ü–∞ `fact_summary` –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### 4. –û–±–Ω–æ–≤–∏—Ç—å frontend
```
1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≤–∫–ª–∞–¥–∫—É Rating
2. –ù–∞–∂–∞—Ç—å Ctrl+F5 (hard refresh)
3. –î–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è —Ä–µ–∞–ª—å–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏ ‚úÖ
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç calculate_fact_summary_from_indicators()

```sql
-- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ú–û –∏ –ø–µ—Ä–∏–æ–¥–∞:
1. SUM(score) WHERE rating_type = '–ü–£–ë–õ–ò–ß–ù–´–ô'      ‚Üí score_public
2. SUM(score) WHERE rating_type = '–ó–ê–ö–†–´–¢–´–ô'       ‚Üí score_closed  
3. SUM(score) WHERE is_penalty = true              ‚Üí score_penalties (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ)
4. AVG(public, closed) + penalties                 ‚Üí score_total
5. IF score_total >= 53: '–ó–µ–ª—ë–Ω–∞—è'
   ELIF score_total >= 29: '–ñ—ë–ª—Ç–∞—è'
   ELSE: '–ö—Ä–∞—Å–Ω–∞—è'                                 ‚Üí zone
```

### –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∏–ª–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ fact_summary

```sql
INSERT ... ON CONFLICT DO UPDATE
-- –ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥, –æ–Ω–∏ –æ–±–Ω–æ–≤—è—Ç—Å—è
```

## ‚ú® –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö 4 —à–∞–≥–æ–≤:

‚úÖ –í–∫–ª–∞–¥–∫–∞ –†–µ–π—Ç–∏–Ω–≥ –ø–æ–∫–∞–∂–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏  
‚úÖ –í—Å–µ 20 –º—É–Ω–∏—Ü–∏–ø–∞–ª–∏—Ç–µ—Ç–æ–≤ –±—É–¥—É—Ç –∏–º–µ—Ç—å –±–∞–ª–ª—ã  
‚úÖ –ë—É–¥—É—Ç –≤–∏–¥–Ω—ã –∑–æ–Ω—ã —Ä–∏—Å–∫–∞ (—Ü–≤–µ—Ç–æ–≤–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ)  
‚úÖ API endpoints –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å  

## üìä –ü—Ä–∏–º–µ—Ä –æ–∂–∏–¥–∞–µ–º–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

| –ú–û | –ü—É–±–ª–∏—á–Ω—ã–π | –ó–∞–∫—Ä—ã—Ç—ã–π | –®—Ç—Ä–∞—Ñ—ã | –ò—Ç–æ–≥–æ | –ó–æ–Ω–∞ |
|---|---|---|---|---|---|
| –õ–∏–ø–µ—Ü–∫ | 22.0 | 25.0 | -2.0 | 22.5 | –ñ—ë–ª—Ç–∞—è |
| –ï–ª–µ—Ü | 19.5 | 23.0 | 0.0 | 21.25 | –ñ—ë–ª—Ç–∞—è |
| –í–æ–ª–æ–≤—Å–∫–∏–π | 14.0 | 15.0 | 0.0 | 14.5 | –ö—Ä–∞—Å–Ω–∞—è |

## üêõ –ï—Å–ª–∏ –≤—Å—ë –µ—â—ë –Ω—É–ª–∏

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
```sql
-- –ï—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ fact_indicator?
SELECT COUNT(*) FROM fact_indicator WHERE period_id = 1;
-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 360+ (18 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ √ó 20 –ú–û)

-- –ï—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ fact_summary?
SELECT COUNT(*) FROM fact_summary WHERE period_id = 1;
-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 20 (–ø–æ –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏ –Ω–∞ –∫–∞–∂–¥–æ–µ –ú–û)

-- –ï—Å—Ç—å –ª–∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏?
SELECT COUNT(*) FROM dim_indicator WHERE code LIKE 'pub_%';
-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 9
```

## üìö –§–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å

- `backend/migrations.py` - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `calculate_fact_summary_from_indicators()`
- GitHub commit: `d6ac3c0`

## üöÄ –ß—Ç–æ –¥–∞–ª—å—à–µ

1. ‚úì –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ –Ω–∞ Amvera
2. ‚úì –í—ã–ø–æ–ª–Ω–∏—Ç—å `load_official_data.sql`
3. ‚úì –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
4. ‚úì Hard refresh frontend
5. ‚úì –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫

**–ì–æ—Ç–æ–≤–æ!** –ù—É–ª–∏ –¥–æ–ª–∂–Ω—ã –∏—Å—á–µ–∑–Ω—É—Ç—å –∏ –ø–æ—è–≤—è—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–µ –±–∞–ª–ª—ã.
