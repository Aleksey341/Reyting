# üìä –°–µ—Å—Å–∏—è: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ (16 –Ω–æ—è–±—Ä—è 2025)

## üéØ –ó–∞–¥–∞—á–∞
–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ production –ë–î Amvera: –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É `leader_name` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å 20 —Ä–µ–∞–ª—å–Ω—ã—Ö –§–ò–û –≥–ª–∞–≤ –º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π –õ–∏–ø–µ—Ü–∫–æ–π –æ–±–ª–∞—Å—Ç–∏.

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ 500 –Ω–∞ production
**–ü—Ä–æ–±–ª–µ–º–∞:** API –≤–æ–∑–≤—Ä–∞—â–∞–ª –æ—à–∏–±–∫—É `InFailedSqlTransaction`
**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω `db.rollback()` –ø—Ä–∏ –æ—à–∏–±–∫–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–ª–æ–Ω–∫–∏
- Commit: `5aaffb9`

### 2. –°–æ–∑–¥–∞–Ω–∞ SQL –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
**–§–∞–π–ª—ã:**
- `backend/migrations/populate_leader_names.sql` - SQL –º–∏–≥—Ä–∞—Ü–∏—è —Å–æ –≤—Å–µ–º–∏ UPDATE –∫–æ–º–∞–Ω–¥–∞–º–∏
- –°–æ–¥–µ—Ä–∂–∏—Ç 20 —Ä–µ–∞–ª—å–Ω—ã—Ö –§–ò–û –≥–ª–∞–≤ –∏–∑ –õ–∏–ø–µ—Ü–∫–æ–π –æ–±–ª–∞—Å—Ç–∏
- –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞ (IF NOT EXISTS –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–ª–æ–Ω–∫–∏)

### 3. –°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏
**–§–∞–π–ª—ã:**
- `AMVERA_COMPLETE_MIGRATION.md` - –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å 4 —Å–ø–æ—Å–æ–±–∞–º–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
- `MIGRATION_QUICK_START.md` - –ö—Ä–∞—Ç–∫–∏–π —Å—Ç–∞—Ä—Ç —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
- `APPLY_MIGRATION_ON_AMVERA.md` - –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è (—Ç–æ–ª—å–∫–æ –∫–æ–ª–æ–Ω–∫–∞)

### 4. –°–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
**–§–∞–π–ª:** `complete_amvera_migration.sh`
**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
- –î–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–ª–æ–Ω–∫—É `leader_name`
- –ó–∞–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ 20 –§–ò–û
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –ø—Ä–∏–º–µ—Ä—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: `./complete_amvera_migration.sh '–ø–∞—Ä–æ–ª—å'`

## üìà GitHub Commits

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–ª–∏—Ç—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π. –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 commits:

```
6b95ba4 - Docs: Add quick start guide for complete Amvera migration
d8de129 - Feat: Add automated complete migration script for Amvera
f62d133 - Feat: Add migration script and guide for populating real leader names
5aaffb9 - Fix: Add transaction rollback to handle missing leader_name column
036b97b - Feat: Add comprehensive migration guide and automation script
```

## üöÄ –°–ø–æ—Å–æ–±—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏

### **–°–ø–æ—Å–æ–± 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç (–°–ê–ú–´–ô –ü–†–û–°–¢–û–ô)**
```bash
./complete_amvera_migration.sh '–≤–∞—à_–ø–∞—Ä–æ–ª—å'
```
- –û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞
- –í—Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ –∫–æ–Ω—Ü–µ

### **–°–ø–æ—Å–æ–± 2: SSH + psql (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)**
```bash
amvera ssh
psql -U reyting_user -d reytingdb -h amvera-alex1976-cnpq-reyting-mo-rw
# –ó–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç—å SQL –∏–∑ MIGRATION_QUICK_START.md
```

### **–°–ø–æ—Å–æ–± 3: –í–µ–±-–∫–æ–Ω—Å–æ–ª—å Amvera**
- https://console.amvera.ru
- Database ‚Üí PostgreSQL ‚Üí reytingdb ‚Üí SQL Query Editor
- –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å SQL –∏–∑ AMVERA_COMPLETE_MIGRATION.md

### **–°–ø–æ—Å–æ–± 4: –û—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã**
```bash
psql -U reyting_user -d reytingdb -h amvera-alex1976-cnpq-reyting-mo-rw \
  -f backend/migrations/populate_leader_names.sql
```

## üìä –î–∞–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏

20 –º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π –õ–∏–ø–µ—Ü–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ —Å –§–ò–û –≥–ª–∞–≤:

| –ú–û | –§–ò–û |
|---|---|
| –õ–∏–ø–µ—Ü–∫ | –ß–µ–Ω—Ü–æ–≤ –†.–ò. |
| –ï–ª–µ—Ü | –ñ–∞–±–∏–Ω –í.–ü. |
| –í–æ–ª–æ–≤—Å–∫–∏–π | –©–µ–≥–ª–æ–≤ –°.–°. |
| –ì—Ä—è–∑—è–Ω—Å–∫–∏–π | –†–æ—â—É–ø–∫–∏–Ω –í.–¢. |
| –î–∞–Ω–∫–æ–≤—Å–∫–∏–π | –§–∞–ª–µ–µ–≤ –í.–ò. |
| –î–æ–±—Ä–∏–Ω—Å–∫–∏–π | –ü–∞—Å—ã–Ω–∫–æ–≤ –ê.–ù. |
| –î–æ–±—Ä–æ–≤—Å–∫–∏–π | –ü–æ–ø–æ–≤ –ê.–ê. |
| –î–æ–ª–≥–æ—Ä—É–∫–æ–≤—Å–∫–∏–π | –¢–∏–º–æ—Ö–∏–Ω –ê.–ù. |
| –ï–ª–µ—Ü–∫–∏–π | –°–µ–º–µ–Ω–∏—Ö–∏–Ω –û.–ù. |
| –ó–∞–¥–æ–Ω—Å–∫–∏–π | –©–µ–¥—Ä–æ–≤ –ê.–ò. |
| –ò–∑–º–∞–ª–∫–æ–≤—Å–∫–∏–π | –ò–≤–∞–Ω–Ω–∏–∫–æ–≤ –í.–Æ. |
| –ö—Ä–∞—Å–Ω–∏–Ω—Å–∫–∏–π | –ü–æ–ª—è–∫–æ–≤ –°.–û. |
| –õ–µ–±–µ–¥—è–Ω—Å–∫–∏–π | –¢–µ–ª–∫–æ–≤ –ê.–ú. |
| –õ–µ–≤-–¢–æ–ª—Å—Ç–æ–≤—Å–∫–∏–π | –®–∞–±–∞–Ω–æ–≤ –ö.–Æ. |
| –õ–∏–ø–µ—Ü–∫–∏–π | –¢–æ–¥—É–∞ –î.–í. |
| –°—Ç–∞–Ω–æ–≤–ª—è–Ω—Å–∫–∏–π | –°–µ–º—è–Ω–Ω–∏–∫–æ–≤ –î.–Æ. |
| –¢–µ—Ä–±—É–Ω—Å–∫–∏–π | –ß–µ—Ä–Ω–∏–∫–æ–≤ –ù.–ï. |
| –£—Å–º–∞–Ω—Å–∫–∏–π | –ú–∞–∑–æ –í.–ú. |
| –•–ª–µ–≤–µ–Ω—Å–∫–∏–π | –ü–ª–æ—Ç–Ω–∏–∫–æ–≤ –ê.–ò. |
| –ß–∞–ø–ª—ã–≥–∏–Ω—Å–∫–∏–π | –°–∞–∑–æ–Ω–æ–≤ –Æ.–ê. |

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### –í –ë–î:
```bash
psql -U reyting_user -d reytingdb -h amvera-alex1976-cnpq-reyting-mo-rw \
  -c "SELECT COUNT(*) FROM dim_mo WHERE leader_name IS NOT NULL;"
# –û–∂–∏–¥–∞–µ—Ç—Å—è: 20
```

### API:
```bash
curl "https://reyting-alex1976.amvera.io/api/rating?period=2024-01&page=1"
# –î–æ–ª–∂–Ω—ã –≤–∏–¥–Ω—ã leader_name —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∏–º–µ–Ω–∞
```

### –í –±—Ä–∞—É–∑–µ—Ä–µ:
1. https://reyting-alex1976.amvera.io
2. –í–∫–ª–∞–¥–∫–∞ "–†–µ–π—Ç–∏–Ω–≥"
3. –î–æ–ª–∂–Ω—ã –≤–∏–¥–Ω—ã –§–ò–û –≥–ª–∞–≤ –≤–æ –≤—Ç–æ—Ä–æ–º —Å—Ç–æ–ª–±—Ü–µ —Ç–∞–±–ª–∏—Ü—ã

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω–Ω—ã–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏:

**SQL –º–∏–≥—Ä–∞—Ü–∏–∏:**
- `backend/migrations/populate_leader_names.sql` - –ú–∏–≥—Ä–∞—Ü–∏—è —Å –§–ò–û

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `AMVERA_COMPLETE_MIGRATION.md` - –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (4 —Å–ø–æ—Å–æ–±–∞)
- `MIGRATION_QUICK_START.md` - –ö—Ä–∞—Ç–∫–∏–π —Å—Ç–∞—Ä—Ç –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- `APPLY_MIGRATION_ON_AMVERA.md` - –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è (–±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞ —Ä–∞–Ω–µ–µ)

**–°–∫—Ä–∏–ø—Ç—ã:**
- `complete_amvera_migration.sh` - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π bash —Å–∫—Ä–∏–ø—Ç

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞:**
- `backend/routes/rating_routes.py` - –î–æ–±–∞–≤–ª–µ–Ω rollback –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫

## üìã –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Amvera –ë–î

```
Host:     amvera-alex1976-cnpq-reyting-mo-rw
Port:     5432
Database: reytingdb
User:     reyting_user
Password: –ò–∑ Amvera Console ‚Üí Settings ‚Üí Secrets ‚Üí DB_PASSWORD
```

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. ‚úÖ **–í—ã–±—Ä–∞—Ç—å —Å–ø–æ—Å–æ–± –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: –°–ø–æ—Å–æ–± 1 –∏–ª–∏ 2)
2. ‚úÖ **–ü–æ–ª—É—á–∏—Ç—å –ø–∞—Ä–æ–ª—å** –∏–∑ Amvera –∫–æ–Ω—Å–æ–ª–∏
3. ‚úÖ **–í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é**
4. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç** (3 —Å–ø–æ—Å–æ–±–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã—à–µ)
5. ‚úÖ **–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –±—Ä–∞—É–∑–µ—Ä** (–æ—á–∏—Å—Ç–∏—Ç—å –∫—ç—à)
6. ‚úÖ **–£–±–µ–¥–∏—Ç—å—Å—è** —á—Ç–æ –§–ò–û –≤–∏–¥–Ω—ã –≤ —Ç–∞–±–ª–∏—Ü–µ —Ä–µ–π—Ç–∏–Ω–≥–∞

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏:
- ‚úÖ –ö–æ–ª–æ–Ω–∫–∞ `leader_name` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –ë–î
- ‚úÖ –í—Å–µ 20 –§–ò–û –≥–ª–∞–≤ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
- ‚úÖ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –§–ò–û –≤–æ –≤—Ç–æ—Ä–æ–º —Å—Ç–æ–ª–±—Ü–µ
- ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ MIGRATION_QUICK_START.md ‚Üí –†–∞–∑–¥–µ–ª "–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º"
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ—á–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ú–û: `SELECT DISTINCT mo_name FROM dim_mo;`
3. –ï—Å–ª–∏ UPDATE –≤–µ—Ä–Ω—É–ª 0 - –æ–±–Ω–æ–≤–∏—Ç–µ WHERE —É—Å–ª–æ–≤–∏—è –ø–æ–¥ —Ä–µ–∞–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è

---

**–î–∞—Ç–∞:** 16 –Ω–æ—è–±—Ä—è 2025
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û –ö –ü–†–ò–ú–ï–ù–ï–ù–ò–Æ
**–í–µ—Ä—Å–∏—è:** 2.0 (Complete)
