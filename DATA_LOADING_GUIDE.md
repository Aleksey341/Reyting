# üìä –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ó–∞–≥—Ä—É–∑–∫–µ –î–∞–Ω–Ω—ã—Ö –û—Ü–µ–Ω–∫–∏ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

–ü–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø–∞–ø–∫–∏ `data_extract` –≤ –ë–î –Ω–∞ Amvera.

---

## üìÅ –ß—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å

### –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
```
C:\Users\cobra\Desktop\–î–∞—à–±–æ—Ä–¥ –õ–∏–ø–µ—Ü–∫–æ–π –æ–±–ª–∞—Å—Ç–∏\...\data_extract\
‚îú‚îÄ‚îÄ –û—Ü–µ–Ω–∫–∞_–ø–æ–¥–¥–µ—Ä–∂–∫–∏_—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è_v1__ALL.csv (57 KB)
‚îî‚îÄ‚îÄ 20 —Ñ–∞–π–ª–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–í–Ω—É—Ç—Ä–∏–º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã, –∏ —Ç.–¥.)
```

**–°–æ–¥–µ—Ä–∂–∏—Ç:**
- 380+ —Å—Ç—Ä–æ–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
- 20 –º—É–Ω–∏—Ü–∏–ø–∞–ª–∏—Ç–µ—Ç–æ–≤ –õ–∏–ø–µ—Ü–∫–æ–π –æ–±–ª–∞—Å—Ç–∏
- 30+ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- –ò–º–µ–Ω–∞ –∏ —Ñ–∞–º–∏–ª–∏–∏ –≥–ª–∞–≤ –ú–û

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:
```
–ü—Ä–æ–µ–∫—Ç/etl/
‚îú‚îÄ‚îÄ load_assessment_data_v2.py  ‚Üê –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ CSV
‚îú‚îÄ‚îÄ load_to_db.py               ‚Üê –ó–∞–≥—Ä—É–∑–∫–∞ –≤ –ë–î
‚îî‚îÄ‚îÄ (–¥—Ä—É–≥–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–∫—Ä–∏–ø—Ç—ã)
```

### –°–æ–∑–¥–∞–≤–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã:
```
extracted_data.json (4.7 MB)  ‚Üê –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
```

---

## üöÄ –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢ (3 —à–∞–≥–∞)

### –®–∞–≥ 1: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (1 –º–∏–Ω—É—Ç–∞)

```bash
cd –ü—Ä–æ–µ–∫—Ç
python etl/load_assessment_data_v2.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
üìä –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• –û–¶–ï–ù–ö–ò –≠–§–§–ï–ö–¢–ò–í–ù–û–°–¢–ò –†–£–ö–û–í–û–î–ò–¢–ï–õ–ï–ô
üìÅ –ù–∞–π–¥–µ–Ω–æ CSV —Ñ–∞–π–ª–æ–≤: 20
...
‚úÖ –ó–ê–ì–†–£–ó–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê
   –í—Å–µ–≥–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: 13814

üíæ –°–æ—Ö—Ä–∞–Ω—è—é –¥–∞–Ω–Ω—ã–µ –≤: extracted_data.json
‚úì –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ 13814 –∑–∞–ø–∏—Å–µ–π

‚úÖ –î–∞–Ω–Ω—ã–µ –≥–æ—Ç–æ–≤—ã –∫ –∑–∞–≥—Ä—É–∑–∫–µ!
   –§–∞–π–ª: C:\...\extracted_data.json
   –ó–∞–ø–∏—Å–µ–π: 13814
   –ü–µ—Ä–∏–æ–¥: 2024-Q4
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –ß–∏—Ç–∞–µ—Ç –≤—Å–µ CSV —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏
- –ü–∞—Ä—Å–∏—Ç –¥–∞–Ω–Ω—ã–µ (–î–∞/–ù–µ—Ç ‚Üí 1/0, —á–∏—Å–ª–∞ ‚Üí float)
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ JSON (–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç)

### –®–∞–≥ 2: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ë–î (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤–∞)

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ:
- ‚úì –ë–î –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ (–∑–∞–ø—É—â–µ–Ω–∞ `database_schema.sql`)
- ‚úì –¢–∞–±–ª–∏—Ü–∞ `dim_mo` —Å–æ–¥–µ—Ä–∂–∏—Ç 20 –º—É–Ω–∏—Ü–∏–ø–∞–ª–∏—Ç–µ—Ç–æ–≤
- ‚úì –¢–∞–±–ª–∏—Ü–∞ `dim_indicator` —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```sql
SELECT COUNT(*) FROM dim_mo;           -- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 20
SELECT COUNT(*) FROM dim_period;       -- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 3+
SELECT COUNT(*) FROM dim_indicator;    -- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 5+
```

### –®–∞–≥ 3: –ó–∞–≥—Ä—É–∑–∫–∞ –≤ –ë–î (2-3 –º–∏–Ω—É—Ç—ã)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –Ω–∞ Amvera)
export DATABASE_URL="postgresql://reyting_user:PASSWORD@amvera-alex1976-cnpq-reyting-mo-rw:5432/reytingdb"

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
python etl/load_to_db.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
üöÄ –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• –í POSTGRESQL –ù–ê AMVERA
üìÅ –§–∞–π–ª –¥–∞–Ω–Ω—ã—Ö: extracted_data.json
üóÑÔ∏è  –ë–î: amvera-alex1976-cnpq-reyting-mo-rw:5432/reytingdb

üìñ –ó–∞–≥—Ä—É–∂–∞—é –¥–∞–Ω–Ω—ã–µ –∏–∑: extracted_data.json
‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ 13814 –∑–∞–ø–∏—Å–µ–π –∏–∑ JSON

======================================================================
üìä –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• –í –ë–î
======================================================================
  –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ 1000/13814 –∑–∞–ø–∏—Å–µ–π...
  –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ 2000/13814 –∑–∞–ø–∏—Å–µ–π...
  ...
‚úÖ –ó–ê–ì–†–£–ó–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê
   –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: 12500+
   –ü—Ä–æ–ø—É—â–µ–Ω–æ: 100
   –û—à–∏–±–æ–∫: 0
   –í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: 13814

======================================================================
üîç –ü–†–û–í–ï–†–ö–ê –ó–ê–ì–†–£–ñ–ï–ù–ù–´–• –î–ê–ù–ù–´–•
======================================================================
‚úì –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π –≤ fact_indicator: 12500+
‚úì –¢–æ–ø 10 –ú–û –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∑–∞–ø–∏—Å–µ–π:
   –õ–∏–ø–µ—Ü–∫: 1250
   –ï–ª–µ—Ü: 980
   ...

‚úì –¢–æ–ø 10 –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∑–∞–ø–∏—Å–µ–π:
   –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á –ê–ì–ü: 2000
   –û—Ü–µ–Ω–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏: 1800
   ...

‚úÖ –£–°–ü–ï–®–ù–û –ó–ê–ì–†–£–ñ–ï–ù–û!
```

---

## üéØ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –í–ê–†–ò–ê–ù–¢–´

### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ Docker Compose (–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã
docker-compose up -d

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ backend
docker-compose exec backend python etl/load_assessment_data_v2.py
docker-compose exec backend python etl/load_to_db.py

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
docker-compose exec backend python -c "
from sqlalchemy import create_engine, text
engine = create_engine('postgresql://dashboard_user:dashboard_password@postgres/dashboard_db')
with engine.connect() as conn:
    result = conn.execute(text('SELECT COUNT(*) FROM fact_indicator'))
    print(f'–ó–∞–≥—Ä—É–∂–µ–Ω–æ: {result.scalar()} –∑–∞–ø–∏—Å–µ–π')
"
```

### –í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ pgAdmin –Ω–∞ Amvera

```
1. –û—Ç–∫—Ä–æ–π—Ç–µ https://console.amvera.ru
2. Database ‚Üí reytingdb ‚Üí pgAdmin
3. –°–æ–∑–¥–∞–π—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ CSV
4. –í—Å—Ç–∞–≤—å—Ç–µ —á–µ—Ä–µ–∑ SQL INSERT
```

### –í–∞—Ä–∏–∞–Ω—Ç C: –ß–µ—Ä–µ–∑ psql Command Line

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –ë–î
psql -h amvera-alex1976-cnpq-reyting-mo-rw \
     -p 5432 \
     -U reyting_user \
     -d reytingdb

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
\COPY fact_indicator (mo_id, period_id, ind_id, value_raw, value_norm, score)
FROM '/path/to/data.csv'
WITH (FORMAT csv, HEADER true);
```

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ó–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö –î–∞–Ω–Ω—ã—Ö

### –ß—Ç–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ CSV:

```
–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π CSV:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –õ–∏—Å—Ç (–∫–∞—Ç–µ–≥–æ—Ä–∏—è)‚îÇ –ú—É–Ω–∏—Ü–∏–ø–∞–ª–∏—Ç–µ—Ç  ‚îÇ –ì–ª–∞–≤–∞ –ú–û     ‚îÇ –ó–Ω–∞—á–µ–Ω–∏–µ  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ê–ì–ü  ‚îÇ –õ–∏–ø–µ—Ü–∫         ‚îÇ –ß–µ–Ω—Ü–æ–≤ –†.–ò.  ‚îÇ 0.95      ‚îÇ
‚îÇ –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã       ‚îÇ –õ–∏–ø–µ—Ü–∫         ‚îÇ –ß–µ–Ω—Ü–æ–≤ –†.–ò.  ‚îÇ –ù–µ—Ç       ‚îÇ
‚îÇ –ü–æ–¥–¥–µ—Ä–∂–∫–∞       ‚îÇ –ï–ª–µ—Ü           ‚îÇ –ñ–∞–±–∏–Ω –í.–ü.   ‚îÇ –î–∞        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

                         ‚Üì‚Üì‚Üì –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è ‚Üì‚Üì‚Üì

JSON (–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π):
[
  {
    "mo_name": "–õ–∏–ø–µ—Ü–∫",
    "head_name": "–ß–µ–Ω—Ü–æ–≤ –†.–ò.",
    "category": "–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á –ê–ì–ü",
    "indicator_code": "AGP_TASKS",
    "value_raw": 0.95,
    "filename": "–û—Ü–µ–Ω–∫–∞_... .csv"
  },
  ...
]

                         ‚Üì‚Üì‚Üì –ó–∞–≥—Ä—É–∑–∫–∞ ‚Üì‚Üì‚Üì

–ë–î (fact_indicator):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ mo_id  ‚îÇperiod_id ‚îÇ ind_id  ‚îÇvalue_raw  ‚îÇvalue_norm  ‚îÇ score ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  1     ‚îÇ    1     ‚îÇ   5     ‚îÇ   0.95    ‚îÇ   95.0     ‚îÇ  10   ‚îÇ
‚îÇ  1     ‚îÇ    1     ‚îÇ   3     ‚îÇ   0.0     ‚îÇ   0.0      ‚îÇ  0    ‚îÇ
‚îÇ  2     ‚îÇ    1     ‚îÇ   2     ‚îÇ   1.0     ‚îÇ   100.0    ‚îÇ  10   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –¢–∞–±–ª–∏—Ü—ã –ë–î:

**dim_mo** - –ú—É–Ω–∏—Ü–∏–ø–∞–ª–∏—Ç–µ—Ç—ã (20 –∑–∞–ø–∏—Å–µ–π)
```
mo_id | mo_name      | oktmo  | lat | lon | population | ...
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  1   | –õ–∏–ø–µ—Ü–∫       | 48,01  | ... | ... | 504000     | ...
  2   | –ï–ª–µ—Ü         | 48,02  | ... | ... | 108000     | ...
  ...
```

**dim_indicator** - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (5+ –∑–∞–ø–∏—Å–µ–π)
```
ind_id | code        | name                      | weight | ...
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  1    | AGP_TASKS   | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á –ê–ì–ü      | 0.1    | ...
  2    | CONFLICTS   | –í–Ω—É—Ç—Ä–∏–º—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω—ã–µ ...   | 0.08   | ...
  ...
```

**fact_indicator** - –î–∞–Ω–Ω—ã–µ (12000+ –∑–∞–ø–∏—Å–µ–π)
```
fi_id | mo_id | period_id | ind_id | value_raw | value_norm | score
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  1   | 1     | 1         | 1      | 0.95      | 95.0       | 10
  2   | 1     | 1         | 2      | 0.0       | 0.0        | 0
  ...
```

---

## üîß –î–µ—Ç–∞–ª–∏ –°–∫—Ä–∏–ø—Ç–æ–≤

### load_assessment_data_v2.py

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- ‚úì –ß–∏—Ç–∞–µ—Ç –≤—Å–µ CSV –∏–∑ –ø–∞–ø–∫–∏
- ‚úì –ü–∞—Ä—Å–∏—Ç –∑–Ω–∞—á–µ–Ω–∏—è (–î–∞/–ù–µ—Ç ‚Üí 1/0, —á–∏—Å–ª–∞ ‚Üí float)
- ‚úì –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ JSON –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
- ‚úì –õ–æ–≥–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```
data_extract/*.csv
```

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```
extracted_data.json (4.7 MB, 13814 –∑–∞–ø–∏—Å–µ–π)
```

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~5 —Å–µ–∫—É–Ω–¥

---

### load_to_db.py

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- ‚úì –ß–∏—Ç–∞–µ—Ç JSON —Å –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚úì –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ PostgreSQL
- ‚úì –í—Å—Ç–∞–≤–ª—è–µ—Ç –≤ fact_indicator
- ‚úì –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è (0-100)
- ‚úì –í—ã—á–∏—Å–ª—è–µ—Ç scores
- ‚úì –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã (ON CONFLICT UPDATE)
- ‚úì –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```
extracted_data.json
DATABASE_URL (–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è)
```

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```
–î–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ fact_indicator
```

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~2-3 –º–∏–Ω—É—Ç—ã (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –ë–î)

---

## ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ü—Ä–æ–±–ª–µ–º—ã –∏ –†–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: "ModuleNotFoundError: No module named 'pandas'"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
pip install pandas sqlalchemy psycopg2-binary
```

### –ü—Ä–æ–±–ª–µ–º–∞: "FileNotFoundError: extracted_data.json not found"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
python etl/load_assessment_data_v2.py

# –ü–æ—Ç–æ–º –∑–∞–≥—Ä—É–∑–∫–∏
python etl/load_to_db.py
```

### –ü—Ä–æ–±–ª–µ–º–∞: "could not connect to server"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DATABASE_URL
echo $DATABASE_URL

# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ñ–æ—Ä–º–∞—Ç:
# postgresql://user:password@host:port/database

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
export DATABASE_URL="postgresql://reyting_user:YOUR_PASSWORD@amvera-alex1976-cnpq-reyting-mo-rw:5432/reytingdb"
```

### –ü—Ä–æ–±–ª–µ–º–∞: "relation dim_mo does not exist"

**–†–µ—à–µ–Ω–∏–µ:**
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ `database_schema.sql` —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ –ë–î `reytingdb`

### –ü—Ä–æ–±–ª–µ–º–∞: "–ó–∞–≥—Ä—É–∂–µ–Ω–æ 0 –∑–∞–ø–∏—Å–µ–π"

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ CSV —Ñ–∞–π–ª—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ `data_extract`
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ CSV –µ—Å—Ç—å –∫–æ–ª–æ–Ω–∫–∞ "–ú—É–Ω–∏—Ü–∏–ø–∞–ª–∏—Ç–µ—Ç"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏—è –ú–û —Å–æ–≤–ø–∞–¥–∞—é—Ç (—Å–º–æ—Ç—Ä–∏—Ç–µ MO_MAPPING –≤ —Å–∫—Ä–∏–ø—Ç–µ)

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ü–æ—Å–ª–µ –ó–∞–≥—Ä—É–∑–∫–∏

### 1. SQL –ü—Ä–æ–≤–µ—Ä–∫–∞

```sql
-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
SELECT COUNT(*) as total FROM fact_indicator;

-- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ú–û
SELECT mo.mo_name, COUNT(*) as indicators_count
FROM fact_indicator fi
JOIN dim_mo mo ON fi.mo_id = mo.mo_id
GROUP BY mo.mo_id, mo.mo_name
ORDER BY indicators_count DESC;

-- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º
SELECT ind.name, COUNT(*) as record_count
FROM fact_indicator fi
JOIN dim_indicator ind ON fi.ind_id = ind.ind_id
GROUP BY fi.ind_id, ind.name
ORDER BY record_count DESC;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ scores
SELECT
    score,
    COUNT(*) as count,
    ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM fact_indicator), 2) as percent
FROM fact_indicator
GROUP BY score
ORDER BY score;
```

### 2. Frontend –ü—Ä–æ–≤–µ—Ä–∫–∞

```
https://reyting.amvera.ru
‚Üí –°—Ç—Ä–∞–Ω–∏—Ü–∞ –†–µ–π—Ç–∏–Ω–≥–∞
‚Üí –î–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å –º—É–Ω–∏—Ü–∏–ø–∞–ª–∏—Ç–µ—Ç–∞–º–∏ –∏ –∏—Ö –¥–∞–Ω–Ω—ã–º–∏
```

### 3. API –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
curl https://api.reyting.amvera.ru/api/rating
curl https://api.reyting.amvera.ru/api/indicators
curl https://api.reyting.amvera.ru/api/map
```

---

## üìà –ß—Ç–æ –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ü–æ—Å–ª–µ –ó–∞–≥—Ä—É–∑–∫–∏

### 1. fact_indicator –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
- 12000+ –∑–∞–ø–∏—Å–µ–π —Å –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º–∏
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ú–û –∏ –ø–µ—Ä–∏–æ–¥–∞
- –° –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∏ scores

### 2. –†–µ–π—Ç–∏–Ω–≥–∏ –±—É–¥—É—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã:
- –ü–æ —Ñ–æ—Ä–º—É–ª–µ: —Å—É–º–º–∞ scores / –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
- –ö–∞–∂–¥–æ–µ –ú–û –ø–æ–ª—É—á–∏—Ç –æ–±—â–∏–π score

### 3. Frontend –ø–æ–∫–∞–∂–µ—Ç:
- –¢–∞–±–ª–∏—Ü—É —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ (–†–µ–π—Ç–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
- –ö–∞—Ä—Ç—É —Å —Ä–∞—Å–∫—Ä–∞—Å–∫–æ–π (–ø–æ –∑–æ–Ω–∞–º: –∑–µ–ª–µ–Ω–∞—è, –∂–µ–ª—Ç–∞—è, –∫—Ä–∞—Å–Ω–∞—è)
- –ê–Ω–∞–ª–∏—Ç–∏–∫—É –ø–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º (–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞)

---

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏:

```bash
# –í –∫–æ–Ω—Å–æ–ª–∏
python etl/load_assessment_data_v2.py  # –í–∏–¥–∏—Ç–µ –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ñ–∞–π–ª
python etl/load_to_db.py > load.log 2>&1

# –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–∞–π–ª
tail -100 load.log
```

### –í–∫–ª—é—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

**–í load_assessment_data_v2.py (—Å—Ç—Ä–æ–∫–∞ 16):**
```python
logging.basicConfig(level=logging.DEBUG)  # –í–º–µ—Å—Ç–æ INFO
```

**–í load_to_db.py (—Å—Ç—Ä–æ–∫–∞ 22):**
```python
logging.basicConfig(level=logging.DEBUG)  # –í–º–µ—Å—Ç–æ INFO
```

---

## üéØ –ò—Ç–æ–≥–æ–≤—ã–π Checklist

–ü–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π:
- [ ] CSV —Ñ–∞–π–ª—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ `data_extract/`
- [ ] –ë–î –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ (`database_schema.sql` –≤—ã–ø–æ–ª–Ω–µ–Ω–∞)
- [ ] –¢–∞–±–ª–∏—Ü–∞ `dim_mo` —Å–æ–¥–µ—Ä–∂–∏—Ç 20 –º—É–Ω–∏—Ü–∏–ø–∞–ª–∏—Ç–µ—Ç–æ–≤
- [ ] Python 3.7+ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: pandas, sqlalchemy, psycopg2-binary

–ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏:
- [ ] –ó–∞–ø—É—Å—Ç–∏–ª–∏ `load_assessment_data_v2.py`
- [ ] –°–æ–∑–¥–∞–ª–∞—Å—å –ø–∞–ø–∫–∞ `extracted_data.json` (4.7 MB)
- [ ] –ó–∞–ø—É—Å—Ç–∏–ª–∏ `load_to_db.py`
- [ ] –£–≤–∏–¥–µ–ª–∏ "–£–°–ü–ï–®–ù–û –ó–ê–ì–†–£–ñ–ï–ù–û!" —Å–æ–æ–±—â–µ–Ω–∏–µ

–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏:
- [ ] `SELECT COUNT(*) FROM fact_indicator;` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç > 10000
- [ ] Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É —Ä–µ–π—Ç–∏–Ω–≥–æ–≤
- [ ] API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON –¥–∞–Ω–Ω—ã–µ

---

## üìû –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–º–æ—â—å

**–§–∞–π–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:**
- `DATA_LOADING_INSTRUCTIONS.md` - –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- `database_schema.sql` - SQL –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü
- README.md - –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ

**–ö–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞:**
```bash
# –ü–æ–º–æ—â—å –ø–æ —Å–∫—Ä–∏–ø—Ç–∞–º
python etl/load_assessment_data_v2.py --help
python etl/load_to_db.py --help

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip list | grep -E "pandas|sqlalchemy|psycopg"
```

---

**–í–µ—Ä—Å–∏—è**: 1.0.0
**–î–∞—Ç–∞**: 04.11.2025
**–°—Ç–∞—Ç—É—Å**: –ì–û–¢–û–í–û –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ

**–£—Å–ø–µ—Ö–æ–≤ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –¥–∞–Ω–Ω—ã—Ö! üöÄ**
