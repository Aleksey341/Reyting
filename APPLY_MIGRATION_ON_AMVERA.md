# –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Amvera

## üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ production –ë–î

```
–•–æ—Å—Ç:        amvera-alex1976-cnpq-reyting-mo-rw
–ü–æ—Ä—Ç:        5432
–ë–∞–∑–∞:        reytingdb
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: reyting_user
–ü–∞—Ä–æ–ª—å:      [—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª–∏ Amvera]
```

---

## üöÄ –°–ü–û–°–û–ë 1: –ß–µ—Ä–µ–∑ SSH (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Amvera –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª/PowerShell –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ
amvera ssh
```

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã –≤—ã –±—É–¥–µ—Ç–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ Amvera.

### –®–∞–≥ 2: –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ PostgreSQL

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –ë–î (–ø–∞—Ä–æ–ª—å –ø–æ–ø—Ä–æ—Å–∏—Ç –∫–æ–Ω—Å–æ–ª—å)
psql -U reyting_user -d reytingdb -h amvera-alex1976-cnpq-reyting-mo-rw -p 5432
```

**–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –ø–∞—Ä–æ–ª—è:**
- –ü–∞—Ä–æ–ª—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª–∏ Amvera ‚Üí Settings ‚Üí Secrets ‚Üí DB_PASSWORD
- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª

### –®–∞–≥ 3: –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –∫–æ–º–∞–Ω–¥—É –≤ psql

```sql
-- –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –≤ psql –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
ALTER TABLE dim_mo ADD COLUMN IF NOT EXISTS leader_name VARCHAR(255);
CREATE INDEX IF NOT EXISTS idx_dim_mo_leader_name ON dim_mo(leader_name);

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–æ–ª–æ–Ω–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞
\d dim_mo

-- –í—ã—Ö–æ–¥ –∏–∑ psql
\q
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
curl "http://localhost:8000/api/rating?period=2024-01&page=1"

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (—Å—Ç–∞—Ç—É—Å 200)
```

---

## üöÄ –°–ü–û–°–û–ë 2: –ß–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å Amvera (–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å Amvera

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://console.amvera.ru
2. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å
3. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Reyting)

### –®–∞–≥ 2: –ù–∞–π—Ç–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL

–í –∫–æ–Ω—Å–æ–ª–∏ Amvera:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Database** ‚Üí **PostgreSQL** (–∏–ª–∏ **Databases**)
2. –ù–∞–π–¥–∏—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö **reytingdb**
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ—ë ‚Üí –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
4. –ù–∞–π–¥–∏—Ç–µ –æ–ø—Ü–∏—é **SQL Query** –∏–ª–∏ **Query Editor**

### –®–∞–≥ 3: –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –∫–æ–º–∞–Ω–¥—É

–í SQL —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –∫–æ–Ω—Å–æ–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```sql
ALTER TABLE dim_mo ADD COLUMN IF NOT EXISTS leader_name VARCHAR(255);
CREATE INDEX IF NOT EXISTS idx_dim_mo_leader_name ON dim_mo(leader_name);
```

–ù–∞–∂–º–∏—Ç–µ **Execute** –∏–ª–∏ **Run Query**

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–í –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏:
```
Query executed successfully
Rows affected: 0 (–∏–ª–∏ 1, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–æ—è–Ω–∏—è)
```

---

## üöÄ –°–ü–û–°–û–ë 3: –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É (Windows PowerShell / macOS Terminal)

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PostgreSQL –∫–ª–∏–µ–Ω—Ç (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

```bash
# Windows (—á–µ—Ä–µ–∑ Chocolatey)
choco install postgresql

# macOS (—á–µ—Ä–µ–∑ Homebrew)
brew install postgresql

# Linux (Ubuntu/Debian)
sudo apt install postgresql-client
```

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ü–æ–ª—É—á–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ Amvera –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
# Windows PowerShell
$env:PGPASSWORD = "your_password_here"

# macOS / Linux
export PGPASSWORD="your_password_here"
```

### –®–∞–≥ 3: –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

```bash
psql -U reyting_user \
  -d reytingdb \
  -h amvera-alex1976-cnpq-reyting-mo-rw \
  -p 5432 \
  -c "ALTER TABLE dim_mo ADD COLUMN IF NOT EXISTS leader_name VARCHAR(255);"

psql -U reyting_user \
  -d reytingdb \
  -h amvera-alex1976-cnpq-reyting-mo-rw \
  -p 5432 \
  -c "CREATE INDEX IF NOT EXISTS idx_dim_mo_leader_name ON dim_mo(leader_name);"
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ø–µ—Ö

```bash
psql -U reyting_user \
  -d reytingdb \
  -h amvera-alex1976-cnpq-reyting-mo-rw \
  -p 5432 \
  -c "SELECT column_name FROM information_schema.columns WHERE table_name='dim_mo' AND column_name='leader_name';"
```

–ï—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –≤—ã–≤–æ–¥:
```
 column_name
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 leader_name
(1 row)
```

---

## üöÄ –°–ü–û–°–û–ë 4: –ß–µ—Ä–µ–∑ SQL —Ñ–∞–π–ª (–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)

### –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª

```bash
amvera ssh
```

### –®–∞–≥ 2: –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL —Ñ–∞–π–ª

```bash
psql -U reyting_user \
  -d reytingdb \
  -h amvera-alex1976-cnpq-reyting-mo-rw \
  -p 5432 \
  -f /app/backend/migrations/add_leader_name_to_mo.sql
```

–§–∞–π–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ SQL –∫–æ–º–∞–Ω–¥—ã.

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—Ö–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ë–î

```sql
-- –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ psql –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ
SELECT column_name, data_type
FROM information_schema.columns
WHERE table_name='dim_mo'
ORDER BY ordinal_position;
```

–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫–æ–ª–æ–Ω–∫–∞:
```
 column_name  | data_type
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 leader_name  | character varying
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API

```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
curl "https://reyting-alex1976.amvera.io/api/rating?period=2024-01&page=1"

# –ò–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
curl "http://localhost:8000/api/rating?period=2024-01&page=1"
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (200) —Å –¥–∞–Ω–Ω—ã–º–∏:
```json
{
  "status": "success",
  "data": [{
    "mo_id": 1,
    "mo_name": "–õ–∏–ø–µ—Ü–∫",
    "leader_name": null,  // –∏–ª–∏ —Ä–µ–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –µ—Å–ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ
    "score_total": 61,
    ...
  }]
}
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://reyting-alex1976.amvera.io (–∏–ª–∏ –≤–∞—à –¥–æ–º–µ–Ω)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–†–µ–π—Ç–∏–Ω–≥"
3. –¢–∞–±–ª–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

---

## üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "column already exists"
```
ERROR: column "leader_name" of relation "dim_mo" already exists
```
**–†–µ—à–µ–Ω–∏–µ:** –ú–∏–≥—Ä–∞—Ü–∏—è —É–∂–µ –±—ã–ª–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞! –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å.

### –û—à–∏–±–∫–∞: "permission denied"
```
ERROR: permission denied for schema public
```
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `reyting_user` –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ –ë–î. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É Amvera.

### –û—à–∏–±–∫–∞: "database does not exist"
```
ERROR: database "reytingdb" does not exist
```
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ë–î –≤ –∫–æ–Ω—Å–æ–ª–∏ Amvera, –º–æ–∂–µ—Ç –±—ã—Ç—å –¥—Ä—É–≥–æ–µ –∏–º—è.

### –û—à–∏–±–∫–∞: "connection refused"
```
psql: error: could not connect to server
```
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ö–æ—Å—Ç: `amvera-alex1976-cnpq-reyting-mo-rw`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–¥–æ—Å—Ç—É–ø –∫ —Ö–æ—Å—Ç—É
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `amvera ssh` –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

---

## üìä –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

### –ó–∞–ø–æ–ª–Ω–∏—Ç—å –§–ò–û –≥–ª–∞–≤ –ú–û (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
psql -U reyting_user \
  -d reytingdb \
  -h amvera-alex1976-cnpq-reyting-mo-rw \
  -p 5432 \
  -f /app/backend/migrations/sample_leader_data.sql
```

### –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
psql -U reyting_user \
  -d reytingdb \
  -h amvera-alex1976-cnpq-reyting-mo-rw \
  -p 5432 \
  -f /app/etl/fill_rating_data_compact.sql
```

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π

1. ‚úÖ **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é** (–¥–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É `leader_name`)
   - –°–ø–æ—Å–æ–± 1 (SSH) - —Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π
   - –°–ø–æ—Å–æ–± 2 (–í–µ–±-–∫–æ–Ω—Å–æ–ª—å) - —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π

2. ‚è≥ **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç** (—Ç–µ—Å—Ç API)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏–ª–∏ curl

3. ‚è≥ **–ó–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - –ó–∞–≥—Ä—É–∑–∏—Ç—å –§–ò–û –≥–ª–∞–≤ –ú–û
   - –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

---

## üéØ –ö—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥

```bash
# SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
amvera ssh

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î (–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ)
psql -U reyting_user -d reytingdb -h amvera-alex1976-cnpq-reyting-mo-rw -p 5432

# –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π
psql -U reyting_user -d reytingdb -h amvera-alex1976-cnpq-reyting-mo-rw -p 5432 \
  -c "ALTER TABLE dim_mo ADD COLUMN IF NOT EXISTS leader_name VARCHAR(255);"
```

---

**–î–∞—Ç–∞:** 16 –Ω–æ—è–±—Ä—è 2024
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –Ω–∞ production
**–í–µ—Ä—Å–∏—è:** 1.0
