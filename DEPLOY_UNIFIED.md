# ๐ ะะฐะทะฒะตัััะฒะฐะฝะธะต ะะดะธะฝะพะณะพ ะัะธะปะพะถะตะฝะธั ะฝะฐ Amvera

**ะััะธัะตะบัััะฐ**: Frontend + Backend ะฒ ะพะดะฝะพะผ ะบะพะฝัะตะนะฝะตัะต
**ะะฐัะฐ**: 2025-11-05
**ะกัะฐััั**: โ ะะพัะพะฒะพ ะบ ัะฐะทะฒะตัััะฒะฐะฝะธั

---

## ๐ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะัะฐัะทะตั ะฟะพะปัะทะพะฒะฐัะตะปั                          โ
โ  https://reyting-alex1976.amvera.io/          โ
โโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
                    โ (Same-origin requests)
                    โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะดะธะฝัะน ะบะพะฝัะตะนะฝะตั (Port 80)                    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  FastAPI Backend                         โ  โ
โ  โ  โโ /api/* โ API endpoints               โ  โ
โ  โ  โโ /assets/* โ Static files (JS/CSS)    โ  โ
โ  โ  โโ / โ index.html                       โ  โ
โ  โ  โโ /* โ index.html (SPA routing)        โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                 โ
โ  ะกัะฐัะธัะตัะบะธะต ัะฐะนะปั: /app/static                โ
โ  โโ index.html                                 โ
โ  โโ assets/                                    โ
โ  โ  โโ index-*.js                             โ
โ  โ  โโ index-*.css                            โ
โ  โโ vite.svg                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
                    โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PostgreSQL Database                           โ
โ  amvera-alex1976-cnpq-reyting-mo-rw:5432      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะัะตะธะผััะตััะฒะฐ:**
- โ ะะดะธะฝ ะดะพะผะตะฝ, ะพะดะฝะพ ะฟัะธะปะพะถะตะฝะธะต
- โ ะะตั CORS ะฟัะพะฑะปะตะผ (same-origin)
- โ ะัะพััะพะต ัะฐะทะฒะตัััะฒะฐะฝะธะต
- โ ะะตะฝััะต ัะตััััะพะฒ (ะพะดะธะฝ ะบะพะฝัะตะนะฝะตั)

---

## ๐ง ะจะฐะณ 1: ะะพะดะณะพัะพะฒะบะฐ

### 1.1 ะฃะฑะตะดะธัะตัั, ััะพ ะฒัะต ัะฐะนะปั ัะพะทะดะฐะฝั

ะัะพะฒะตัััะต ะฝะฐะปะธัะธะต ัะฐะนะปะพะฒ ะฒ ัะตะฟะพะทะธัะพัะธะธ:

```bash
cd Reyting
ls -la Dockerfile.unified
ls -la amvera-unified.yml
ls -la backend/main.py
ls -la frontend/.env.production
```

### 1.2 ะะฐะบะพะผะผะธัััะต ะธะทะผะตะฝะตะฝะธั ะฒ Git

```bash
git add .
git commit -m "feat: unified frontend+backend deployment"
git push origin main
```

---

## ๐ ะจะฐะณ 2: ะะฐะทะฒะตัััะฒะฐะฝะธะต ะฝะฐ Amvera

### ะะฐัะธะฐะฝั A: ะงะตัะตะท ะบะพะฝัะพะปั Amvera (ะะตะบะพะผะตะฝะดัะตััั)

1. **ะัะบัะพะนัะต ะบะพะฝัะพะปั Amvera**: https://console.amvera.ru

2. **ะฃะดะฐะปะธัะต ััะฐััะต ัะตัะฒะธัั** (ะตัะปะธ ะตััั):
   - ะฃะดะฐะปะธัะต `reyting-frontend` (ะตัะปะธ ัััะตััะฒัะตั)
   - ะฃะดะฐะปะธัะต `reyting-backend` (ะตัะปะธ ัััะตััะฒัะตั)

3. **ะกะพะทะดะฐะนัะต ะฝะพะฒะพะต ะฟัะธะปะพะถะตะฝะธะต**:
   - ะะฐะถะผะธัะต **"ะกะพะทะดะฐัั ะฟัะธะปะพะถะตะฝะธะต"** ะธะปะธ **"New Application"**
   - ะัะฑะตัะธัะต **"From repository"**

4. **ะะฐัััะพะนัะต ะธััะพัะฝะธะบ**:
   ```
   Repository: https://github.com/Aleksey341/Reyting
   Branch: main
   ```

5. **ะะฐัััะพะนัะต ัะฑะพัะบั (Build)**:
   ```
   Dockerfile path: Dockerfile.unified  โฌ๏ธ ะะะะะ!
   Build context: .                     โฌ๏ธ ะะพัะฝะตะฒะฐั ะดะธัะตะบัะพัะธั
   ```

6. **ะะฐัััะพะนัะต ะทะฐะฟััะบ (Runtime)**:
   ```
   Container port: 80
   Memory: 1 GB
   CPU: 0.5
   ```

7. **ะะพะฑะฐะฒััะต ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั (Environment Variables)**:
   ```
   DATABASE_URL = postgresql://reyting_user:YOUR_PASSWORD@amvera-alex1976-cnpq-reyting-mo-rw:5432/reytingdb
   DEBUG = False
   API_TITLE = Reyting Dashboard API
   PYTHONUNBUFFERED = 1
   STATIC_DIR = /app/static
   ALLOWED_ORIGINS = *
   ```

   โ๏ธ **ะะะะะ**: ะะฐะผะตะฝะธัะต `YOUR_PASSWORD` ะฝะฐ ัะตะฐะปัะฝัะน ะฟะฐัะพะปั ะพั ะะ!

8. **ะะฐัััะพะนัะต ะดะพะผะตะฝ**:
   ```
   Domain: reyting-alex1976.amvera.io
   Path: / โ Port 80
   ```

9. **ะะฐะถะผะธัะต "Deploy"** ะธ ะฟะพะดะพะถะดะธัะต 5-7 ะผะธะฝัั

### ะะฐัะธะฐะฝั B: ะงะตัะตะท Amvera CLI

ะัะปะธ ั ะฒะฐั ัััะฐะฝะพะฒะปะตะฝ Amvera CLI:

```bash
cd Reyting
amvera deploy --config amvera-unified.yml
```

---

## โ ะจะฐะณ 3: ะัะพะฒะตัะบะฐ

### 3.1 ะัะพะฒะตัััะต health check

```bash
curl https://reyting-alex1976.amvera.io/health
```

ะะพะปะถะตะฝ ะฒะตัะฝััั:
```json
{"status": "ok", "service": "reyting-api"}
```

### 3.2 ะัะพะฒะตัััะต frontend

ะัะบัะพะนัะต ะฒ ะฑัะฐัะทะตัะต:
```
https://reyting-alex1976.amvera.io/
```

ะะพะปะถะฝะฐ ะพัะบัััััั ะณะปะฐะฒะฝะฐั ัััะฐะฝะธัะฐ ะดะฐัะฑะพัะดะฐ.

### 3.3 ะัะพะฒะตัััะต API

```bash
curl https://reyting-alex1976.amvera.io/api
```

ะะพะปะถะตะฝ ะฒะตัะฝััั JSON ั ะธะฝัะพัะผะฐัะธะตะน ะพะฑ API endpoints.

### 3.4 ะัะพะฒะตัััะต API ะดะพะบัะผะตะฝัะฐัะธั

ะัะบัะพะนัะต ะฒ ะฑัะฐัะทะตัะต:
```
https://reyting-alex1976.amvera.io/api/docs
```

---

## ๐ ะะพะณะธ ะธ ะผะพะฝะธัะพัะธะฝะณ

### ะัะพัะผะพัั ะปะพะณะพะฒ

ะ ะบะพะฝัะพะปะธ Amvera:
1. ะัะบัะพะนัะต ะฟัะธะปะพะถะตะฝะธะต
2. ะะตัะตะนะดะธัะต ะฒ ัะฐะทะดะตะป **"Logs"**
3. ะัะพะฒะตัััะต ะปะพะณะธ ะทะฐะฟััะบะฐ:

```
โ Static files directory found: /app/static
โ Serving frontend static files from /assets
โ CORS configured for 1 origin(s)
โ Database tables ready
INFO:     Started server process [1]
INFO:     Uvicorn running on http://0.0.0.0:80
```

---

## ๐ง ะะพะบะฐะปัะฝะพะต ัะตััะธัะพะฒะฐะฝะธะต (ะพะฟัะธะพะฝะฐะปัะฝะพ)

ะัะปะธ ัะพัะธัะต ะฟัะพัะตััะธัะพะฒะฐัั ะปะพะบะฐะปัะฝะพ ัะตัะตะท Docker:

```bash
cd Reyting

# ะกะพะฑะตัะธัะต ะพะฑัะฐะท
docker build -f Dockerfile.unified -t reyting-unified .

# ะะฐะฟัััะธัะต ะบะพะฝัะตะนะฝะตั
docker run -p 8080:80 \
  -e DATABASE_URL="postgresql://reyting_user:YOUR_PASSWORD@amvera-alex1976-cnpq-reyting-mo-rw:5432/reytingdb" \
  -e DEBUG=False \
  -e STATIC_DIR=/app/static \
  reyting-unified

# ะัะบัะพะนัะต ะฒ ะฑัะฐัะทะตัะต
open http://localhost:8080
```

---

## โ ะะตัะตะฝะธะต ะฟัะพะฑะปะตะผ

### ะัะพะฑะปะตะผะฐ: 404 Not Found

**ะัะธัะธะฝะฐ**: Frontend ะฝะต ัะพะฑัะฐะปัั ะธะปะธ ะฝะตะฟัะฐะฒะธะปัะฝัะน ะฟััั ะบ ััะฐัะธะบะต

**ะะตัะตะฝะธะต**:
1. ะัะพะฒะตัััะต ะปะพะณะธ ัะฑะพัะบะธ ะฒ Amvera
2. ะฃะฑะตะดะธัะตัั, ััะพ `Dockerfile: Dockerfile.unified` (ะฝะต `Dockerfile`)
3. ะัะพะฒะตัััะต, ััะพ ะฒ ะปะพะณะฐั ะตััั: `โ Static files directory found`

### ะัะพะฑะปะตะผะฐ: API ะฝะต ัะฐะฑะพัะฐะตั (CORS ะพัะธะฑะบะฐ)

**ะัะธัะธะฝะฐ**: Frontend ะฟััะฐะตััั ะพะฑัะฐัะธัััั ะบ ะฝะตะฟัะฐะฒะธะปัะฝะพะผั URL

**ะะตัะตะฝะธะต**:
1. ะัะพะฒะตัััะต `frontend/.env.production`:
   ```bash
   VITE_API_BASE=/api
   ```
2. ะะตัะตัะพะฑะตัะธัะต ะฟัะธะปะพะถะตะฝะธะต

### ะัะพะฑะปะตะผะฐ: 500 Internal Server Error

**ะัะธัะธะฝะฐ**: ะัะพะฑะปะตะผะฐ ั ะะ ะธะปะธ backend ะบะพะดะพะผ

**ะะตัะตะฝะธะต**:
1. ะัะพะฒะตัััะต ะปะพะณะธ ะฒ ะบะพะฝัะพะปะธ Amvera
2. ะัะพะฒะตัััะต `DATABASE_URL` ะฒ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั
3. ะฃะฑะตะดะธัะตัั, ััะพ ะะ ะดะพัััะฟะฝะฐ

---

## ๐ ะงัะพ ะธะทะผะตะฝะธะปะพัั

### ะกะพะทะดะฐะฝะฝัะต ัะฐะนะปั:
1. **`Dockerfile.unified`** - ะะดะธะฝัะน Dockerfile ะดะปั ัะฑะพัะบะธ
2. **`amvera-unified.yml`** - ะะพะฝัะธะณััะฐัะธั ะดะปั Amvera
3. **`DEPLOY_UNIFIED.md`** - ะญัะฐ ะธะฝััััะบัะธั

### ะะทะผะตะฝะตะฝะฝัะต ัะฐะนะปั:
1. **`backend/main.py`** - ะะพะฑะฐะฒะปะตะฝะฐ ัะฐะทะดะฐัะฐ ััะฐัะธะบะธ:
   - Mount `/assets` ะดะปั JS/CSS
   - Route `/` ะฒะพะทะฒัะฐัะฐะตั index.html
   - Catch-all route ะดะปั SPA routing

2. **`frontend/.env.production`** - ะะฑะฝะพะฒะปะตะฝ ะบะพะผะผะตะฝัะฐัะธะน:
   - `VITE_API_BASE=/api` (same-origin)

---

## ๐ ะะพัะพะฒะพ!

ะะพัะปะต ัะฐะทะฒะตัััะฒะฐะฝะธั ะฒะฐั ะดะฐัะฑะพัะด ะฑัะดะตั ะดะพัััะฟะตะฝ ะฟะพ ะฐะดัะตัั:

**https://reyting-alex1976.amvera.io/**

ะัะต ะทะฐะฟัะพัั ะพะฑัะฐะฑะฐััะฒะฐัััั ะพะดะฝะธะผ ะฟัะธะปะพะถะตะฝะธะตะผ:
- `/` โ React frontend
- `/api/*` โ FastAPI backend
- ะะตะท CORS, ะฑะตะท ะฟัะพะฑะปะตะผ! ๐
